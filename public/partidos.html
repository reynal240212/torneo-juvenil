<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Partidos y Resultados</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f5f8ff; }
    .partido-card {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px #0001;
      padding: 1.2rem 1.5rem;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .equipos {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .equipo-nombre {
      font-size: 1.3rem;
      font-weight: 600;
      color: #182347;
      margin-bottom: 0.3rem;
      display: flex;
      align-items: center;
      gap:0.5em;
    }
    .vs { color: #4e64fa; font-weight: bold; margin: 0.4em 0; }
    .partido-hora {
      font-size: 1.15rem;
      color: #2535b8;
      font-weight: 700;
    }
    .partido-btn {
      margin-top: .8em;
    }
    @media (max-width: 600px) {
      .partido-card { flex-direction: column; align-items: flex-start; }
      .partido-hora { align-self: flex-end; margin-bottom: 1em; }
    }
  </style>
</head>
<body>
  <div class="container mt-4 mb-5">
    <h2 class="mb-3 fw-bold text-primary">Partidos y Resultados</h2>
    <div id="partidosList"></div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://cwlvpzossqmpuzdpjrsh.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN3bHZwem9zc3FtcHV6ZHBqcnNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0MDc5NTIsImV4cCI6MjA3Njk4Mzk1Mn0.PPq8uCEx9Tu1B6iBtS2eCHogGSRaxc5tWPF8PZnU-Go";
    const supabase = createClient(supabaseUrl, supabaseKey);

    function claseEstado(estado = "") {
      switch (estado.toUpperCase()) {
        case "FINALIZADO": return "badge bg-success text-white";
        case "OTORGADO":   return "badge bg-warning text-dark";
        case "PROGRAMADO": return "badge bg-info text-dark";
        case "EN JUEGO":   return "badge bg-primary text-white";
        case "CANCELADO":  return "badge bg-danger text-white";
        default:           return "badge bg-secondary text-white";
      }
    }
    function formatearFecha(fechaISO) {
      try {
        return fechaISO ? new Date(fechaISO).toLocaleDateString('es-CO', { weekday:'long', year:'numeric', month:'short', day:'numeric' }) : "-";
      } catch { return "-"; }
    }

    function partidoCard(p) {
      const hora = p.hora || "-";
      const fecha = formatearFecha(p.fecha);
      const estadoHtml = `<span class="${claseEstado(p.estado)} fw-bold">${p.estado || 'â€”'}</span>`;
      const resultado = (p.goles_local !== null && p.goles_visitante !== null)
        ? `<span class="text-danger">${p.goles_local}</span> - <span class="text-primary">${p.goles_visitante}</span>`
        : `<span class="vs">VS</span>`;
      return `
        <div class="partido-card">
          <div class="equipos">
            <div class="equipo-nombre">${p.equipo_local}</div>
            ${resultado}
            <div class="equipo-nombre">${p.equipo_visitante}</div>
            <div class="text-secondary small">${fecha} ${estadoHtml}</div>
          </div>
          <div class="partido-hora text-end">${hora}
            <br>
            <button class="btn btn-outline-primary btn-sm partido-btn" type="button" disabled>Ver detalles</button>
          </div>
        </div>
      `;
    }
    async function cargarPartidos() {
      const el = document.getElementById("partidosList");
      el.innerHTML = '<div class="my-5 text-center text-muted">Cargando partidos...</div>';
      const { data, error } = await supabase
        .from("vista_resultados")
        .select("*")
        .order("jornada", { ascending: true })
        .order("fecha",   { ascending: true })
        .order("hora",    { ascending: true });

      if (error || !data) {
        el.innerHTML = `<div class="alert alert-danger">Error al cargar partidos</div>`;
        return;
      }
      if (data.length === 0) {
        el.innerHTML = `<div class="alert alert-info">No hay partidos por mostrar</div>`;
        return;
      }
      el.innerHTML = data.map(partidoCard).join('');
    }

    document.addEventListener("DOMContentLoaded", cargarPartidos);
  </script>
</body>
</html>
