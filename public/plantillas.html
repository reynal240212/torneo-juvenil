<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jugadores - Torneo Juvenil La Pradera</title>
  <meta name="description"
    content="Consulta los jugadores del Torneo Juvenil La Pradera y filtra por nombre, equipo o posición.">
  <meta name="author" content="Organización Torneo Juvenil La Pradera">
  <meta name="theme-color" content="#0082C9">

  <link rel="icon" href="https://torneo-juvenil.vercel.app/images/EscudoTorneo.png" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style/style.css" />
  <style>
    body {
      min-height: 100vh;
    }
    .info-shadow {
      box-shadow: 0 8px 32px rgba(0, 130, 201, 0.11);
    }
  </style>
</head>

<body>
  <div id="nav-placeholder"></div>

  <main class="container my-4" style="max-width:1240px;">
    <h1 class="mb-4 text-center" style="color:#0082C9;"><i class="fas fa-users"></i> Jugadores</h1>

    <!-- FILTROS -->
    <div class="card-torneo info-shadow mb-4 p-3">
      <form id="filtroForm" class="row g-3 align-items-end">
        <div class="col-md-4">
          <label for="filtroSelect" class="form-label fw-bold">Filtrar por</label>
          <select id="filtroSelect" class="form-select">
            <option value="">-- Seleccionar campo --</option>
            <option value="nombre">Nombre</option>
            <option value="equipo">Equipo</option>
            <option value="posicion">Posición</option>
          </select>
        </div>
        <div class="col-md-5">
          <label for="filtroInput" class="form-label fw-bold">Valor</label>
          <input type="text" id="filtroInput" class="form-control" placeholder="Ej: Atlético Pradera, Juan, Defensa...">
        </div>
        <div class="col-md-3 d-grid">
          <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Buscar</button>
          <button type="button" id="resetButton" class="btn btn-outline-secondary mt-2"><i class="fas fa-rotate"></i> Limpiar</button>
        </div>
      </form>
    </div>

    <!-- TABLA -->
    <div class="card-torneo info-shadow">
      <h3 class="mb-3"><i class="fas fa-list"></i> Lista de Jugadores</h3>
      <div class="table-responsive">
        <table class="table align-middle text-center table-hover mb-0" id="tablaJugadores">
          <thead>
            <tr>
              <th>#</th>
              <th>Nombre</th>
              <th>Equipo</th>
              <th>Posición</th>
              <th>Edad</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="5" class="text-muted">Cargando jugadores...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <!-- Cargar navbar y footer -->
  <script>
    Promise.all([
      fetch('layout/navbar.html').then(r => r.text()).then(h => { document.getElementById('nav-placeholder').innerHTML = h; }),
      fetch('layout/footer.html').then(r => r.text()).then(h => { document.getElementById('footer-placeholder').innerHTML = h; })
    ]).catch(console.error);
  </script>

  <!-- Script de Supabase -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://cwlvpzossqmpuzdpjrsh.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN3bHZwem9zc3FtcHV6ZHBqcnNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0MDc5NTIsImV4cCI6MjA3Njk4Mzk1Mn0.PPq8uCEx9Tu1B6iBtS2eCHogGSRaxc5tWPF8PZnU-Go";
    const supabase = createClient(supabaseUrl, supabaseKey);

    async function cargarJugadores(filtro, valor) {
      let query = supabase.from("jugadores").select("*").order("id_jugador");
      if (filtro && valor) {
        query = query.ilike(filtro, `%${valor}%`);
      }

      const { data, error } = await query;
      const cuerpo = document.querySelector("#tablaJugadores tbody");
      cuerpo.innerHTML = "";

      if (error) {
        cuerpo.innerHTML = `<tr><td colspan="5" class="text-danger">Error al cargar jugadores: ${error.message}</td></tr>`;
        return;
      }

      if (!data || data.length === 0) {
        cuerpo.innerHTML = `<tr><td colspan="5" class="text-muted">No se encontraron jugadores.</td></tr>`;
        return;
      }

      data.forEach(j => {
        cuerpo.innerHTML += `
          <tr>
            <td>${j.id_jugador}</td>
            <td>${j.nombre}</td>
            <td>${j.equipo}</td>
            <td>${j.posicion}</td>
            <td>${j.edad}</td>
          </tr>`;
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      cargarJugadores();
    });

    document.getElementById("filtroForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const filtro = document.getElementById("filtroSelect").value;
      const valor = document.getElementById("filtroInput").value.trim();
      cargarJugadores(filtro, valor);
    });

    document.getElementById("resetButton").addEventListener("click", function () {
      document.getElementById("filtroInput").value = "";
      document.getElementById("filtroSelect").value = "";
      cargarJugadores();
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
